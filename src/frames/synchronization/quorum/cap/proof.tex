% SPDX-License-Identifier: CC-BY-SA-4.0
% Author: Matthieu Perrin
% Part: 
% Section: 
% Sub-section: 
% Frame: 

\begingroup

\SetKwFunction{Read}{read}
\SetKwFunction{Write}{write}
\SetKwData{X}{x}
\SetKwData{Y}{y}

\begin{frame}{Démonstration du théorème CAP}

  \on[width=1.01\textwidth, top]{
    Supposons (par contradiction) une telle mémoire dans $\mathcal{CAMP}_{n,t}\left[t\ge\frac{n}{2}\right]$.

    \begin{itemize}
    \item Il existe une partition $X, Y$ telle que
      \begin{itemize}
      \item $X \cap Y = \emptyset$, et $X \cup Y = \{p_1, ..., p_n\}$
      \item $|X| \le t$, et $|Y| \le t$
      \end{itemize}
    \end{itemize}
  }

  \onBlock<2->[y=19mm, left=.45\textwidth, anchor=north]{Scénario S1}{
    \begin{tikzpicture}[x=10mm, y=4mm, anchor=center]
      \draw[process] (0,3) node[left] {$p_1$} to (4,3) node (x1) {}; 
      \draw[process] (0,2) node[left] {$p_2$} to (4,2) node (x2) {}; 
      \draw[crashed] (0,1) node[left] {$p_3$} to (.5,1) node (y1) {}; 
      \draw[crashed] (0,0) node[left] {$p_4$} to (.5,0) node (y2) {}; 
      
      \path (x1.north) edge[brace] node {$X$} (x2.south);
      \path (y1.north) edge[brace] node {$Y$} (y2.south);
      
      \scriptsize
      \node[example,   operation] at (1.0,3) {$\X.\Write(1)$};
      \node[alert,     operation] at (2.9,3) {$\Y.\Read() \rightarrow 0$};
    \end{tikzpicture}
  }

  \onBlock<2->[y=19mm, right=.45\textwidth, anchor=north]{Scénario S2}{
    \begin{tikzpicture}[x=10mm, y=4mm, anchor=center]
      \draw[crashed] (0,3) node[left] {$p_1$} to (.5,3) node (x1) {} ; 
      \draw[crashed] (0,2) node[left] {$p_2$} to (.5,2) node (x2) {} ; 
      \draw[process] (0,1) node[left] {$p_3$} to (4,1)  node (y1) {} ; 
      \draw[process] (0,0) node[left] {$p_4$} to (4,0)  node (y2) {} ; 
      
      \path (x1.north) edge[brace] node {$X$} (x2.south);
      \path (y1.north) edge[brace] node {$Y$} (y2.south);

      \scriptsize
      \node[alert,     operation] at (1.0,0) {$\Y.\Write(1)$};
      \node[example,   operation] at (2.9,0) {$\X.\Read() \rightarrow 0$};
    \end{tikzpicture}
  }

  \on[y=-7mm, width=1.01\textwidth, anchor=north]{
    \begin{itemize}
    \item<2-> S1 et S2 ont moins de $t$ pannes
      \begin{itemize}
      \item toutes les opérations terminent
      \item les lectures retournent 0
      \end{itemize}
    \item<3-> S3 est indistingable de S1 pour $X$
      \begin{itemize}
      \item $\Y.\Read()$ retourne $0$
      \end{itemize}
    \item<3-> S3 est indistingable de S2 pour $Y$
      \begin{itemize}
      \item $\X.\Read()$ retourne $0$
      \end{itemize}
    \item<3-> RW1 est possible : contradiction ! 
    \end{itemize}
  }

  \onBlock<3->[y=-10mm, right=.45\textwidth, anchor=north]{Scénario S3}{
    \begin{tikzpicture}[x=10mm, y=4mm, anchor=center]
      \draw[process] (0,4) node[left] {$p_1$} to (4,4) node (x1) {}; 
      \draw[process] (0,3) node[left] {$p_2$} to (4,3) node (x2) {}; 
      \draw[process] (0,1) node[left] {$p_3$} to (4,1) node (y1) {}; 
      \draw[process] (0,0) node[left] {$p_4$} to (4,0) node (y2) {}; 

      \draw[dashed]   (0,2) -- (4,2) node[above left] {\tiny réseau lent};

      \path (x1.north) edge[brace] node {$X$} (x2.south);
      \path (y1.north) edge[brace] node {$Y$} (y2.south);
      
      \scriptsize
      \node[example,   operation] at (1.0,4) {$\X.\Write(1)$};
      \node[alert,     operation] at (2.9,4) {$\Y.\Read() \rightarrow 0$};
      \node[alert,     operation] at (1.0,0) {$\Y.\Write(1)$};
      \node[example,   operation] at (2.9,0) {$\X.\Read() \rightarrow 0$};
    \end{tikzpicture}
  }
  
\end{frame}

\endgroup
\endinput
